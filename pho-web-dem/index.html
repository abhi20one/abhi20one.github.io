
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Share Image</title>
    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-storage.js"></script>
    <!-- Custom CSS -->
    <style>
        *{
            margin: 0px;
            padding: 0px;
        
        }
  

        body {
            background-color: rgb(34, 34, 34);
            
        }

        button{
            font-family: 'Courier New', monospace;
            font-size: 1em;
            border-radius: 2px;
            border: 1px solid rgb(0, 0, 0);
        }
        
        .sec2{
            float: right;
            width: 30%;
            height:100vh;
        }
        .sec1{
            position: fixed;
            float: right;
            width: 70%;
            height:100vh;
            background-color: rgb(0, 0, 0);
        }

        .resizer {
            position: fixed;
            top: 40vh;
            height: 100px;
            width: 10px;
            border-radius: 20px;
            background-color: rgba(106, 106, 106, 0.5);
            z-index: 11;
            cursor: col-resize;
            transition: background-color 0.3s ease; /* Smooth transition */
          }
          .resizer:hover {
            background-color: rgba(106, 106, 106,0.9); /* Lighter color on hover */
          }
        
        .heading{
            font-family: Copperplate, Papyrus, fantasy;
            font-size: 1em;
            text-align: center;
            color: rgb(255, 255, 255);
        }

        .gallery {
            display: flex;
            flex-wrap: wrap;
        }

        .gallery img {
            max-width:100px;
            max-height:100px;

            border-radius: 2px;
            border: 1px solid rgb(0, 0, 0);

            margin: 2px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(20%, 1fr));
            grid-gap: 5px;
        } 

        
        .modal-content {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 94vh;         
        }
        .modal img {
            object-fit: scale-down;
        }
        
    </style>
</head>
<body>

    <section class="sec2"> 
        <input type="file" class="inp" style="display:none" multiple onchange="getImageData(event)">
        
        <button onclick="selectImage()">Select Image</button>       
        <button onclick="uploadImages()">Upload Image</button>
        <button onclick="cancelSelection()">Clear</button>
        <button onclick="deleteSelectedImage()">Delete</button>

        <div class="filedata" style="display:none"></div>
        <div class="progress"></div>
        <div class="loading"></div>
        <div class="gallery" id="imageGallery"></div>
        <div class="resizer"></div>
    </section>
    
    <section class="sec1"> 
        <div class="heading">
            <h2>SHARE IMAGE</h2>
        </div>

        <div id="myModal" class="modal">
            <img class="modal-content" id="modalImg">
            <div class="firimg" id="firstImg"></div>
        </div>
        
    </section>

<script>
    
    const s2 = document.querySelector(".sec2");
const s1 = document.querySelector(".sec1");
let isResizing = false;
const resizers = document.querySelectorAll(".resizer");
let currentResizer;

function getMinWidth1() {
  return window.innerWidth * 0.2; // 20% of the screen width for .sec1
}

function getMaxWidth1() {
  return window.innerWidth * 0.9; // 90% of the screen width for .sec1
}

function getMinWidth2() {
  return window.innerWidth * 0.1; // 10% of the screen width for .sec2
}

function getMaxWidth2() {
  return window.innerWidth * 0.8; // 80% of the screen width for .sec2
}

for (let resizer of resizers) {
  resizer.addEventListener("mousedown", mousedown);
  resizer.addEventListener("touchstart", touchstart);

  function mousedown(e) {
    startResizing(e.clientX);
    window.addEventListener("mousemove", mousemove);
    window.addEventListener("mouseup", mouseup);
  }

  function touchstart(e) {
    startResizing(e.touches[0].clientX);
    window.addEventListener("touchmove", touchmove);
    window.addEventListener("touchend", touchend);
  }

  function startResizing(startX) {
    currentResizer = event.target;
    isResizing = true;
    let prevX = startX;

    function mousemove(e) {
      resize(e.clientX);
    }

    function touchmove(e) {
      resize(e.touches[0].clientX);
    }

    function resize(currentX) {
      if (!isResizing) return;

      const minWidth1 = getMinWidth1();
      const maxWidth1 = getMaxWidth1();
      const minWidth2 = getMinWidth2();
      const maxWidth2 = getMaxWidth2();

      const rectel2 = s2.getBoundingClientRect();
      const rectel1 = s1.getBoundingClientRect();

      let newWidth2 = rectel2.width + (prevX - currentX);
      let newWidth1 = rectel1.width - (prevX - currentX);

      // Apply the boundary limits for .sec2
      if (newWidth2 < minWidth2) {
        newWidth2 = minWidth2;
        newWidth1 = rectel1.width + rectel2.width - minWidth2;
      } else if (newWidth2 > maxWidth2) {
        newWidth2 = maxWidth2;
        newWidth1 = rectel1.width + rectel2.width - maxWidth2;
      }

      // Apply the boundary limits for .sec1
      if (newWidth1 < minWidth1) {
        newWidth1 = minWidth1;
        newWidth2 = rectel1.width + rectel2.width - minWidth1;
      } else if (newWidth1 > maxWidth1) {
        newWidth1 = maxWidth1;
        newWidth2 = rectel1.width + rectel2.width - maxWidth1;
      }

      s2.style.width = newWidth2 + "px";
      s1.style.width = newWidth1 + "px";

      prevX = currentX;
    }

    function mouseup() {
      stopResizing();
      window.removeEventListener("mousemove", mousemove);
      window.removeEventListener("mouseup", mouseup);
    }

    function touchend() {
      stopResizing();
      window.removeEventListener("touchmove", touchmove);
      window.removeEventListener("touchend", touchend);
    }

    function stopResizing() {
      isResizing = false;
    }
  }
}











    const firebaseConfig = {
        apiKey: "AIzaSyACMxdb_zpcrkA3UO02s7O3X7FI4_cRRdA",
        authDomain: "img-upload-45286.firebaseapp.com",
        projectId: "img-upload-45286",
        storageBucket: "img-upload-45286.appspot.com",
        messagingSenderId: "469648648126",
        appId: "1:469648648126:web:47515aade6b907c9d8fbef",
        measurementId: "G-JTMNS5GX4T"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
    const storageRef = storage.ref();
    
    let currentImageRef = null;




    



    const selectImage = () => {
        $('.inp').click();
    };

    const cancelSelection = () => {
        $('.inp').val(''); // Clear the value of the file input element
        $('.filedata').empty(); // Clear the displayed file names
        $('.progress').css('display', 'none'); // Hide the progress percentage
    };    
    
    const getImageData = (e) => {
        // Handle file input change
        const files = e.target.files;
        $('.filedata').empty(); // Clear previous file data
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            $('.filedata').append('<div>' + file.name + '</div>');
        }
        $('.filedata').css('display', 'block');
    };

    const uploadImages = () => {
        const files = $('.inp')[0].files;
        if (files.length === 0) {
            alert('Please select one or more files to upload.');
            return;
        }
    
        $('.loading').css('display', 'block');
    
        // Track the number of successfully uploaded images
        let uploadedCount = 0;
    
        // Fetch the list of existing images to determine the next serial number
        storageRef.child('myimages/').listAll().then(function(result){
            let existingImagesCount = result.items.length;
    
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const serialNumber = existingImagesCount + i + 1; // Incrementing index to start from existingImagesCount + 1
                const fileName = serialNumber + '_' + file.name;
                const uploadTask = storageRef.child('myimages/' + fileName).put(file);
    
                uploadTask.on(
                    "state_changed",
                    (snapshot) => {
                        // Update progress for each file individually
                        const progress = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);
                        $('.progress').css('width', progress + '%').text(progress + '%');
                    },
                    (error) => {
                        console.log(error);
                        $('.loading').css('display', 'none');
                    },
                    () => {
                        console.log("File Uploaded Successfully");
                        // Increase the count of uploaded images
                        uploadedCount++;
    
                        // If all files are uploaded, hide loading indicator and refresh gallery
                        if (uploadedCount === files.length) {
                            $('.loading').css('display', 'none');
                            listAllImages();
                        }
                    }
                );
            }
        }).catch(function(error){
            console.log("Error listing images: ", error);
        });
    };
    
    


    






    const listAllImages = () => {
        noImage();
        $('#imageGallery').empty();
        storageRef.child('myimages/').listAll().then(function(result){
            let images = [];
            result.items.forEach(function(imageRef){
                images.push(imageRef);
            });
            images.sort((a, b) => {
                let aNumber = parseInt(a.name.split('_')[0]);
                let bNumber = parseInt(b.name.split('_')[0]);
                return bNumber - aNumber;
            });
            defaultImage(images, 0);
            displayImage(images, 0);
        }).catch(function(error){
            console.log("Error listing images: ", error);
        });
    };

    const defaultImage = (images, index) => {

        if (images.length == 0) {
            hideImage();  // Call a function to hide the currently displayed image
            return;
        }
 
        if (index >= images.length) {
            let imageRef = images[--index];
            imageRef.getDownloadURL().then(function(url){
            openImage(url,imageRef.fullPath,0);
            }).catch(function(error){
            console.log("Error getting download URL: ", error);
            });
        }
   
        let imageRef = images[index];
        imageRef.getDownloadURL().then(function(url){
            openImage(url,imageRef.fullPath,0);
            //console.log( imageRef.fullPath); 

            console.log("Imagelength", images.length); 

            //console.log("Image url and index", url, index);
        }).catch(function(error){
            console.log("Error getting download URL: ", error);
        });    
    };

    const displayImage = (images, index) => {
        if (index >= images.length) {
            return;
        }
        let imageRef = images[index];
        imageRef.getDownloadURL().then(function(url){
            appendImageToGallery(url, imageRef,index);
            //console.log("Image url and index", url, index); 
            displayImage(images, index + 1);
        }).catch(function(error){
            console.log("Error getting download URL: ", error);
        });    
    };

    const appendImageToGallery = (url, imageRef,index) => {
        //console.log("Appending image to gallery:", url);
        
        console.log("append",index);
        
        $('#imageGallery').append(`
            <div>
                <img src="${url}" alt="Image" onclick="openImage('${url}', '${imageRef.fullPath}','${index}')">
            </div>
        `);
    };





    
    const openImage = (url, fullPath,index) => {
        const modal = document.getElementById("myModal");
        const modalImg = document.getElementById("modalImg");
        modal.style.display = "block";
        modalImg.src = url;

        console.log("openimg",index);
        
        currentindex = index;
        currentImageRef = fullPath;
             
    };
    


    const hideImage = () => {
        modalImg.src = 'https://static.thenounproject.com/png/1211233-200.png';
    };

    const noImage = () => {
        modalImg.src = 'https://upload.wikimedia.org/wikipedia/commons/5/59/Empty.png';
    };
    
    




    const deleteSelectedImage = () => {

        console.log("del",currentindex);

        console.error(currentImageRef);
        if (!currentImageRef) {
            alert("No image selected to delete.");
            return;
        }

        if (!confirm("Are you sure you want to delete this image?")) return;
        storageRef.child(currentImageRef).delete().then(() => {
            console.error(currentImageRef);
            displaynextImage();
        }).catch((error) => {
            console.error("Error deleting image: ", error);
        });
    };
    
    const displaynextImage = () => {
        $('#imageGallery').empty();
        storageRef.child('myimages/').listAll().then(function(result){
            let images = [];
            result.items.forEach(function(imageRef){
                images.push(imageRef);
            });
            images.sort((a, b) => {
                let aNumber = parseInt(a.name.split('_')[0]);
                let bNumber = parseInt(b.name.split('_')[0]);
                return bNumber - aNumber;
            });

            console.log("delcurr",currentindex);
            
            defaultImage(images, currentindex);
            displayImage(images, 0);
        }).catch(function(error){
            console.log("Error listing images: ", error);
        });
    };



   

    // Initial load of images
    document.addEventListener('DOMContentLoaded', listAllImages);



    

            
</script>


</body>
</html>
